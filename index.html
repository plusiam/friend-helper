<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>친구 마음 도우미 워크시트</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&display=swap');
        
        * {
            font-family: 'Noto Sans KR', sans-serif;
        }
        
        /* A4 출력 최적화 */
        @media print {
            body {
                font-size: 10pt;
                line-height: 1.2;
                color: black !important;
                background: white !important;
                margin: 0;
                padding: 0;
            }
            
            .no-print {
                display: none !important;
            }
            
            .print-area {
                width: 210mm;
                margin: 0;
                padding: 8mm;
                box-shadow: none !important;
                border: none !important;
            }
            
            .step-box {
                border: 1px solid #333 !important;
                background: white !important;
                margin-bottom: 4mm;
                padding: 3mm;
                border-radius: 4px;
                page-break-inside: avoid;
            }
            
            .print-only h1 {
                font-size: 16pt !important;
                margin-bottom: 6px !important;
            }
            
            .print-only .flex {
                font-size: 8pt !important;
                margin-bottom: 8px !important;
            }
            
            h3 {
                font-size: 11pt !important;
                margin-bottom: 4px !important;
            }
            
            .step-number {
                width: 24px !important;
                height: 24px !important;
                font-size: 10pt !important;
                margin-right: 6px !important;
            }
            
            .emoji-large {
                font-size: 1.2rem !important;
            }
            
            label {
                font-size: 9pt !important;
                margin-bottom: 3px !important;
                font-weight: 600 !important;
            }
            
            input, textarea {
                border-bottom: 1px solid #333 !important;
                background: transparent !important;
                color: black !important;
                padding: 2px 4px !important;
                font-size: 9pt !important;
                line-height: 1.2 !important;
                min-height: 14px !important;
            }
            
            textarea {
                min-height: 24px !important;
                max-height: 36px !important;
            }
            
            .checkbox-item {
                margin-bottom: 1mm;
                font-size: 8pt !important;
                line-height: 1.1 !important;
                padding: 1px 0 !important;
            }
            
            .custom-checkbox {
                width: 12px !important;
                height: 12px !important;
                margin-right: 4px !important;
            }
            
            .positive-words-area {
                padding: 3mm !important;
                margin: 2mm 0 !important;
            }
            
            .positive-words-area textarea {
                min-height: 32px !important;
                max-height: 48px !important;
            }
            
            .positive-words-area p {
                font-size: 7pt !important;
                margin: 2px 0 !important;
            }
            
            .space-y-6 > * + * {
                margin-top: 3mm !important;
            }
            
            .space-y-4 > * + * {
                margin-top: 2mm !important;
            }
            
            .mb-6 {
                margin-bottom: 3mm !important;
            }
            
            .mb-4 {
                margin-bottom: 2mm !important;
            }
            
            .mb-3 {
                margin-bottom: 1.5mm !important;
            }
            
            .p-4 {
                padding: 2mm !important;
            }
            
            .bg-yellow-50 {
                background: #fffbeb !important;
                padding: 2mm !important;
                font-size: 9pt !important;
                border-left: 2px solid #f59e0b !important;
            }
            
            .bg-purple-50 {
                background: #faf5ff !important;
                padding: 1.5mm !important;
            }
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #fef7ff 0%, #f0f9ff 50%, #f0fff4 100%);
        }
        
        .step-box {
            background: linear-gradient(145deg, #ffffff 0%, #fefefe 100%);
            border: 2px solid #e0e7ff;
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.1);
        }
        
        .situation-card {
            transition: all 0.3s ease;
            cursor: pointer;
            background: white;
            border-radius: 16px;
            padding: 20px;
            border: 2px solid #e5e7eb;
            min-height: 140px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        
        .situation-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 30px rgba(139, 92, 246, 0.15);
            border-color: #a855f7;
        }
        
        .situation-card.selected {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            color: white;
            transform: translateY(-4px);
            box-shadow: 0 12px 30px rgba(139, 92, 246, 0.3);
            border-color: #6d28d9;
        }
        
        .situation-card.selected h3 {
            color: white;
        }
        
        .situation-card.selected p {
            color: rgba(255, 255, 255, 0.9);
        }
        
        .situation-card h3 {
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 8px;
            line-height: 1.3;
        }
        
        .situation-card p {
            font-size: 0.85rem;
            line-height: 1.4;
            color: #6b7280;
            flex-grow: 1;
        }
        
        .input-field {
            border: 2px solid #e0e7ff;
            background: #fafafa;
            transition: all 0.3s ease;
        }
        
        .input-field:focus {
            border-color: #8b5cf6;
            background: white;
            box-shadow: 0 0 0 4px rgba(139, 92, 246, 0.1);
            transform: translateY(-1px);
        }
        
        .checkbox-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.15);
        }
        
        .positive-words-area {
            background: linear-gradient(145deg, #fef7ff, #f3e8ff);
            border: 2px dashed #8b5cf6;
            min-height: 100px;
            position: relative;
            animation: subtle-glow 3s ease-in-out infinite alternate;
        }
        
        @keyframes subtle-glow {
            0% {
                box-shadow: 0 0 20px rgba(139, 92, 246, 0.1);
            }
            100% {
                box-shadow: 0 0 30px rgba(139, 92, 246, 0.2);
            }
        }
        
        .custom-checkbox:checked {
            background: #8b5cf6;
            transform: scale(1.1);
            animation: checkbox-bounce 0.3s ease;
        }
        
        @keyframes checkbox-bounce {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1.1); }
        }
        
        .emoji-large {
            font-size: 2rem;
        }
        
        .step-number {
            background: linear-gradient(145deg, #8b5cf6, #7c3aed);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
        }
        
        /* 체크박스 커스텀 스타일 */
        .custom-checkbox {
            appearance: none;
            width: 20px;
            height: 20px;
            border: 2px solid #8b5cf6;
            border-radius: 4px;
            background: white;
            cursor: pointer;
            position: relative;
        }
        
        .custom-checkbox:checked {
            background: #8b5cf6;
        }
        
        .custom-checkbox:checked::after {
            content: "✓";
            color: white;
            font-weight: bold;
            position: absolute;
            top: -2px;
            left: 3px;
        }
    </style>
</head>
<body class="gradient-bg min-h-screen py-6">
    <div class="container mx-auto px-4 max-w-4xl">
        <!-- 헤더 -->
        <div class="text-center mb-12 no-print">
            <div class="relative">
                <h1 class="text-5xl font-bold bg-gradient-to-r from-purple-600 via-pink-500 to-orange-400 bg-clip-text text-transparent mb-4">
                    친구 마음 도우미 워크시트 💝
                </h1>
                <div class="absolute -top-2 -right-2 text-2xl animate-bounce">✨</div>
                <div class="absolute -bottom-2 -left-2 text-2xl animate-pulse">🌟</div>
            </div>
            <p class="text-xl text-gray-600 max-w-2xl mx-auto leading-relaxed">
                친구의 마음을 이해하고 도와주는 방법을 배워보아요!
            </p>
            <div class="mt-6 flex justify-center space-x-2">
                <span class="inline-block w-3 h-3 bg-purple-400 rounded-full animate-bounce"></span>
                <span class="inline-block w-3 h-3 bg-pink-400 rounded-full animate-bounce" style="animation-delay: 0.1s;"></span>
                <span class="inline-block w-3 h-3 bg-orange-400 rounded-full animate-bounce" style="animation-delay: 0.2s;"></span>
            </div>
        </div>

        <!-- 상황 선택 -->
        <div class="step-box rounded-2xl p-8 mb-8 no-print">
            <div class="flex items-center justify-between mb-6">
                <div class="flex items-center">
                    <span class="emoji-large mr-3">🎯</span>
                    <h2 class="text-2xl font-bold text-gray-800">상황을 선택해주세요</h2>
                </div>
                <button 
                    id="shuffleBtn" 
                    class="px-6 py-3 bg-orange-500 text-white rounded-xl font-semibold hover:bg-orange-600 transition-all duration-300 transform hover:scale-105 shadow-lg flex items-center gap-2"
                >
                    🔄 <span>다른 예시</span>
                </button>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-6" id="situationCards">
                <!-- 상황 카드들이 여기에 동적으로 생성됩니다 -->
            </div>
            
            <div class="text-center">
                <p class="text-sm text-gray-500 flex items-center justify-center gap-2">
                    <span>💡</span>
                    <span>총 100가지 상황이 준비되어 있어요! "다른 예시" 버튼을 눌러보세요.</span>
                </p>
            </div>
        </div>

        <!-- 선택된 상황 설명 (하단에 표시) -->
        <div id="situationDetailCard" class="step-box rounded-2xl p-6 mb-6 no-print" style="display: none;">
            <div class="flex items-start gap-4">
                <div class="flex-shrink-0">
                    <div class="w-12 h-12 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center">
                        <span class="text-white text-xl">📖</span>
                    </div>
                </div>
                <div class="flex-grow">
                    <h3 class="text-xl font-bold text-gray-800 mb-3">상황</h3>
                    <div id="situationDetailDescription" class="text-gray-700 leading-relaxed p-4 bg-gradient-to-r from-yellow-50 to-orange-50 rounded-lg border-l-4 border-yellow-400">
                    </div>
                </div>
            </div>
        </div>

        <!-- 워크시트 영역 -->
        <div id="worksheetArea" class="print-area">
            <!-- 워크시트 헤더 (출력용) -->
            <div class="text-center mb-6 print-only" style="display: none;">
                <h1 class="text-3xl font-bold text-purple-700 mb-2">
                    친구 마음 도우미 워크시트 💝
                </h1>
                <div class="flex justify-between text-sm text-gray-600 mb-4">
                    <span>이름: ________________</span>
                    <span>날짜: ________________</span>
                    <span>학급: ________________</span>
                </div>
            </div>

            <!-- 선택된 상황 표시 -->
            <div id="selectedSituation" class="step-box rounded-2xl p-6 mb-6" style="display: none;">
                <div class="flex items-center mb-4">
                    <span class="emoji-large mr-3">📖</span>
                    <h3 class="text-xl font-bold text-gray-800">상황</h3>
                </div>
                <div id="situationDescription" class="text-lg text-gray-700 bg-yellow-50 p-4 rounded-lg border-l-4 border-yellow-400">
                </div>
            </div>

            <!-- 1단계: 친구 마음 알아차리기 & 공감 표현하기 -->
            <div id="step1" class="step-box rounded-2xl p-6 mb-6" style="display: none;">
                <div class="flex items-center mb-6">
                    <div class="step-number mr-4">1</div>
                    <div>
                        <h3 class="text-xl font-bold text-gray-800">친구 마음 알아차리기 & 공감 표현하기</h3>
                        <p class="text-sm text-gray-600">친구가 어떤 기분일지 생각해보고, 공감하는 말을 써보세요</p>
                    </div>
                    <span class="emoji-large ml-auto">💝</span>
                </div>

                <div class="space-y-6">
                    <div>
                        <label class="block text-lg font-semibold text-gray-700 mb-3">
                            🎭 친구가 어떤 기분일까요?
                        </label>
                        <input 
                            type="text" 
                            id="friendEmotion" 
                            class="input-field w-full p-4 rounded-lg text-lg"
                            placeholder="예: 슬픈 기분, 화난 기분, 걱정되는 기분..."
                        >
                    </div>

                    <div>
                        <label class="block text-lg font-semibold text-gray-700 mb-3">
                            💬 친구에게 공감하는 말을 해주세요
                        </label>
                        <textarea 
                            id="empathyWords" 
                            class="input-field w-full p-4 rounded-lg text-lg h-24"
                            placeholder="예: 정말 속상했겠다. 나도 그런 일이 있으면 화가 날 것 같아."
                        ></textarea>
                    </div>
                </div>
            </div>

            <!-- 2단계: 도움 방법 제안하기 -->
            <div id="step2" class="step-box rounded-2xl p-6 mb-6" style="display: none;">
                <div class="flex items-center mb-6">
                    <div class="step-number mr-4">2</div>
                    <div>
                        <h3 class="text-xl font-bold text-gray-800">도움 방법 제안하기</h3>
                        <p class="text-sm text-gray-600">친구를 도울 수 있는 방법들을 선택해보세요</p>
                    </div>
                    <span class="emoji-large ml-auto">🤝</span>
                </div>

                <div id="helpMethods" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- 도움 방법들이 동적으로 생성됩니다 -->
                </div>

                <div class="mt-6">
                    <label class="block text-lg font-semibold text-gray-700 mb-3">
                        ✨ 다른 도움 방법이 있다면 써주세요
                    </label>
                    <textarea 
                        id="additionalHelp" 
                        class="input-field w-full p-4 rounded-lg text-lg h-20"
                        placeholder="친구를 도울 수 있는 다른 방법을 자유롭게 써주세요..."
                    ></textarea>
                </div>
            </div>

            <!-- 3단계: 긍정의 말로 힘주기 -->
            <div id="step3" class="step-box rounded-2xl p-6 mb-6" style="display: none;">
                <div class="flex items-center mb-6">
                    <div class="step-number mr-4">3</div>
                    <div>
                        <h3 class="text-xl font-bold text-gray-800">긍정의 말로 힘주기</h3>
                        <p class="text-sm text-gray-600">친구에게 용기와 힘을 주는 긍정적인 말을 써주세요</p>
                    </div>
                    <span class="emoji-large ml-auto">✨</span>
                </div>

                <div class="positive-words-area rounded-xl p-6 relative overflow-hidden">
                    <div class="absolute top-0 right-0 text-6xl opacity-10">💖</div>
                    <div class="absolute bottom-0 left-0 text-4xl opacity-10">🌟</div>
                    
                    <label class="block text-lg font-semibold text-gray-700 mb-4">
                        🌟 친구에게 힘이 되는 말을 써주세요
                    </label>
                    <textarea 
                        id="positiveWords" 
                        class="w-full p-4 rounded-lg text-lg border-2 border-purple-200 bg-white h-32 resize-none focus:border-purple-400 focus:ring-4 focus:ring-purple-100 transition-all duration-300"
                        placeholder="예: 너는 정말 소중한 친구야. 이 어려움도 잘 이겨낼 수 있을 거야. 내가 항상 네 편이니까 걱정하지 마!"
                    ></textarea>
                    
                    <div class="mt-4 p-4 bg-gradient-to-r from-purple-50 to-pink-50 rounded-lg border border-purple-100">
                        <p class="text-sm text-purple-700 font-semibold flex items-center gap-2">
                            <span>💡</span>
                            <span>힌트</span>
                        </p>
                        <p class="text-sm text-purple-600 mt-1">
                            "너는 할 수 있어", "나는 네가 자랑스러워", "함께 해결해보자" 같은 따뜻한 말을 써보세요!
                        </p>
                    </div>
                </div>
            </div>

            <!-- 완성 확인 및 성찰 -->
            <div id="reflection" class="step-box rounded-2xl p-6 mb-6 relative overflow-hidden" style="display: none;">
                <div class="absolute top-0 right-0 text-6xl opacity-10">🌈</div>
                <div class="absolute bottom-0 left-0 text-4xl opacity-10">✨</div>
                
                <div class="flex items-center mb-6">
                    <span class="emoji-large mr-3">🌈</span>
                    <h3 class="text-xl font-bold text-gray-800">나의 상담 성찰</h3>
                </div>

                <div class="space-y-6">
                    <div>
                        <label class="block text-lg font-semibold text-gray-700 mb-3 flex items-center gap-2">
                            <span>😊</span>
                            <span>친구를 도우면서 어떤 기분이었나요?</span>
                        </label>
                        <input 
                            type="text" 
                            id="myFeeling" 
                            class="input-field w-full p-4 rounded-lg text-lg focus:ring-4 focus:ring-purple-100"
                            placeholder="예: 뿌듯했어요, 친구가 기뻐해서 좋았어요..."
                        >
                    </div>

                    <div>
                        <label class="block text-lg font-semibold text-gray-700 mb-3 flex items-center gap-2">
                            <span>📚</span>
                            <span>오늘 새롭게 배운 점이 있나요?</span>
                        </label>
                        <textarea 
                            id="learning" 
                            class="input-field w-full p-4 rounded-lg text-lg h-24 focus:ring-4 focus:ring-purple-100"
                            placeholder="친구를 도우면서 배운 점을 써주세요..."
                        ></textarea>
                    </div>
                </div>
            </div>
        </div>

        <!-- 버튼 영역 -->
        <div class="flex flex-col sm:flex-row gap-4 justify-center no-print mt-12">
            <button 
                id="nextStepBtn" 
                class="px-8 py-4 bg-gradient-to-r from-purple-600 to-purple-700 text-white rounded-xl font-semibold text-lg hover:from-purple-700 hover:to-purple-800 transition-all duration-300 transform hover:scale-105 shadow-lg hover:shadow-xl flex items-center justify-center gap-2"
                style="display: none;"
            >
                <span>다음 단계로</span>
                <span>💜</span>
            </button>
            
            <button 
                id="printBtn" 
                class="px-8 py-4 bg-gradient-to-r from-green-600 to-green-700 text-white rounded-xl font-semibold text-lg hover:from-green-700 hover:to-green-800 transition-all duration-300 transform hover:scale-105 shadow-lg hover:shadow-xl flex items-center justify-center gap-2"
                style="display: none;"
            >
                <span>📄</span>
                <span>출력하기</span>
            </button>
            
            <button 
                id="downloadBtn" 
                class="px-8 py-4 bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-xl font-semibold text-lg hover:from-blue-700 hover:to-blue-800 transition-all duration-300 transform hover:scale-105 shadow-lg hover:shadow-xl flex items-center justify-center gap-2"
                style="display: none;"
            >
                <span>📸</span>
                <span>이미지로 저장</span>
            </button>
            
            <button 
                id="resetBtn" 
                class="px-8 py-4 bg-gradient-to-r from-gray-500 to-gray-600 text-white rounded-xl font-semibold text-lg hover:from-gray-600 hover:to-gray-700 transition-all duration-300 transform hover:scale-105 shadow-lg hover:shadow-xl flex items-center justify-center gap-2"
                style="display: none;"
            >
                <span>🔄</span>
                <span>다시 시작</span>
            </button>
        </div>
    </div>

    <script>
        // 상황 데이터 (100가지)
        const allSituations = [
            // 친구 관계 문제
            {
                id: 1,
                title: "친구와 싸웠어요 😢",
                description: "우리 반 민수가 갑자기 화를 내면서 말을 걸어도 대답을 안 해요. 어제 같이 놀던 친구인데 무슨 일인지 모르겠어요. 민수는 혼자 구석에 앉아서 슬퍼 보여요.",
                helpMethods: ["진심으로 사과하기", "친구 마음 물어보기", "함께 이야기할 시간 만들기", "먼저 다가가서 인사하기", "좋아하는 간식 나누어주기", "같이 놀자고 제안하기"]
            },
            {
                id: 2,
                title: "약속을 지키지 않아서 화났어요 😠",
                description: "오늘 방과 후에 같이 놀기로 했는데 지희가 갑자기 안 온다고 연락했어요. 벌써 세 번째예요. 화가 나지만 어떻게 말해야 할지 모르겠어요.",
                helpMethods: ["솔직하게 기분 말하기", "다음엔 꼭 지키자고 말하기", "왜 그랬는지 이유 물어보기", "함께 새로운 약속 정하기", "이해해주려고 노력하기", "다른 친구들과도 놀기"]
            },
            {
                id: 3,
                title: "비밀을 다른 친구에게 말했어요 😨",
                description: "나만 알아달라고 했던 비밀을 수진이가 다른 친구들에게 다 말했어요. 이제 반 친구들이 모두 알게 되어서 당황스럽고 배신감이 들어요.",
                helpMethods: ["솔직하게 상처받았다고 말하기", "왜 비밀을 말했는지 물어보기", "앞으로는 조심하자고 말하기", "서로 믿을 수 있는 방법 찾기", "시간을 두고 생각해보기", "선생님께 도움 요청하기"]
            },
            {
                id: 4,
                title: "친구가 다른 친구하고만 놀아요 😔",
                description: "단짝친구였던 예린이가 요즘 새로운 친구 은지하고만 놀아요. 나는 빼고 둘이서만 비밀 이야기도 하고, 저만 외톨이가 된 기분이에요.",
                helpMethods: ["내 기분을 솔직하게 말하기", "세 명이 함께 놀 방법 제안하기", "새로운 친구들과도 어울리기", "예린이와 둘만의 시간 만들기", "질투하지 않으려고 노력하기", "다양한 친구 사귀기"]
            },
            {
                id: 5,
                title: "자꾸 놀려서 짜증나요 😤",
                description: "반 친구들이 제 별명을 이상하게 부르면서 자꾸 놀려요. 처음엔 재미있었는데 이제는 정말 싫어요. 그만하라고 해도 계속해요.",
                helpMethods: ["단호하게 싫다고 말하기", "선생님께 도움 요청하기", "친구들에게 어떤 기분인지 설명하기", "다른 별명 제안하기", "무시하고 다른 친구들과 놀기", "부모님께 이야기하기"]
            },
            // 학업 스트레스
            {
                id: 6,
                title: "시험이 걱정돼요 😰",
                description: "내일 수학 시험인데 지수가 계속 \"어떡하지, 어떡하지\" 하면서 걱정만 하고 있어요. 공부를 열심히 했는데도 자꾸 틀릴까봐 무서워해요.",
                helpMethods: ["함께 공부하기", "격려하는 말 해주기", "문제 함께 풀어보기", "시험 잘 보는 방법 알려주기", "긴장하지 말라고 위로하기", "자신감을 가지라고 응원하기"]
            },
            {
                id: 7,
                title: "숙제가 너무 어려워요 😵",
                description: "과학 숙제가 너무 어려워서 계속 울고 있어요. 어떻게 해야 할지 모르겠다고 포기하려고 해요. 내일까지 해야 하는데 시간도 없어요.",
                helpMethods: ["함께 문제 읽어보기", "쉬운 부분부터 차근차근 하기", "선생님께 질문하라고 격려하기", "인터넷이나 책에서 찾아보기", "부모님께 도움 요청하기", "포기하지 말라고 응원하기"]
            },
            {
                id: 8,
                title: "성적이 떨어져서 속상해요 📉",
                description: "이번 성적표를 받고 나서 많이 속상해해요. 열심히 했다고 생각했는데 예상보다 점수가 낮아서 자신감이 많이 떨어졌어요.",
                helpMethods: ["열심히 한 노력 인정해주기", "다음에 더 잘할 수 있다고 격려하기", "공부 방법 함께 찾아보기", "좋은 점 찾아서 말해주기", "함께 계획 세우기", "성적이 전부가 아니라고 위로하기"]
            },
            // 새로운 환경 적응
            {
                id: 9,
                title: "새 학교가 무서워요 😨",
                description: "전학 온 새 친구 하늘이가 혼자서 쉬는 시간에도 계속 자리에만 앉아 있어요. 다른 친구들과 어떻게 친해져야 할지 모르겠다고 해요.",
                helpMethods: ["먼저 친구가 되어주기", "다른 친구들에게 소개해주기", "함께 놀이하기", "점심시간에 같이 먹기", "학교 구경시켜주기", "좋은 추억 만들어주기"]
            },
            {
                id: 10,
                title: "새 반이 적응이 안 돼요 😟",
                description: "새 학년이 되면서 반이 바뀌었는데 아는 친구가 별로 없어요. 전 반 친구들이 그리워서 새로운 반에 적응하기가 어려워요.",
                helpMethods: ["새로운 친구들과 대화하기", "전 반 친구들과도 계속 연락하기", "새 반의 좋은 점 찾아보기", "함께 활동할 기회 만들기", "시간이 지나면 괜찮아진다고 격려하기", "선생님께 도움 요청하기"]
            },
            // 자신감/자존감 문제
            {
                id: 11,
                title: "놀림받아서 속상해요 😭",
                description: "키가 작은 우리 반 소라가 다른 아이들한테 자꾸 놀림을 받아서 울고 있어요. 점점 자신감도 없어지고 말도 잘 안 하려고 해요.",
                helpMethods: ["놀리는 친구들에게 그만하라고 말하기", "선생님께 알려드리기", "소라의 좋은 점 찾아서 말해주기", "함께 있어주기", "소라를 지켜주기", "재미있는 이야기로 기분 풀어주기"]
            },
            {
                id: 12,
                title: "발표할 때 너무 떨려요 😰",
                description: "내일 발표를 해야 하는데 무대에 서면 다리가 떨리고 목소리도 안 나와요. 친구들이 저를 어떻게 생각할지 걱정돼요.",
                helpMethods: ["집에서 미리 연습해보기", "자신감을 가지라고 격려하기", "발표 내용 함께 점검하기", "떨려도 괜찮다고 위로하기", "발표 후 칭찬해주기", "실수해도 괜찮다고 말해주기"]
            },
            // 가족 문제
            {
                id: 13,
                title: "가족이 걱정돼요 😟",
                description: "우리 반 준호가 요즘 할머니가 아프셔서 걱정이 많아요. 수업시간에도 자꾸 딴생각을 하고, 평소보다 말도 별로 안 해요.",
                helpMethods: ["할머니 안부 물어보기", "마음을 다해서 들어주기", "힘내라고 응원해주기", "같이 기도해주기", "따뜻한 관심 보여주기", "즐거운 이야기로 기분 전환시켜주기"]
            },
            {
                id: 14,
                title: "부모님이 자꾸 싸우세요 😢",
                description: "집에서 엄마 아빠가 자주 싸우셔서 무서워해요. 혹시 자기 때문에 싸우는 건 아닌지 걱정하고, 집에 가기 싫어해요.",
                helpMethods: ["네 잘못이 아니라고 말해주기", "마음을 털어놓을 수 있게 들어주기", "선생님께 상담 받아보라고 하기", "함께 있어주기", "재미있는 활동으로 기분 전환하기", "상담 선생님께 도움 요청하기"]
            },
            // 외로움/소외감
            {
                id: 15,
                title: "혼자 놀게 되어서 외로워요 😔",
                description: "항상 같이 놀던 단짝친구가 다른 반으로 이사를 가게 되었어요. 이제 쉬는 시간마다 혼자 있게 되어서 외롭고 심심해해요.",
                helpMethods: ["새로운 친구 사귀도록 도와주기", "함께 놀아주기", "재미있는 활동 제안하기", "그룹 활동에 초대하기", "취미나 관심사 물어보기", "따뜻하게 말 걸어주기"]
            },
            {
                id: 16,
                title: "아무도 저와 놀아주지 않아요 😞",
                description: "쉬는 시간에 친구들에게 같이 놀자고 해도 다들 바쁘다고 하거나 다른 핑계를 대요. 혼자 있는 시간이 많아서 외로워요.",
                helpMethods: ["먼저 다가가서 친구 되어주기", "함께 할 수 있는 놀이 제안하기", "좋은 점들 찾아서 말해주기", "그룹 활동에 초대하기", "선생님께 상황 알려드리기", "관심사나 취미 함께 나누기"]
            },
            // 감정 조절
            {
                id: 17,
                title: "화가 나서 조절이 안 돼요 😡",
                description: "작은 일에도 쉽게 화를 내고 친구들에게 소리를 지르기도 해요. 나중에 후회가 되지만 그 순간엔 참을 수가 없어요.",
                helpMethods: ["화가 날 때 심호흡하라고 알려주기", "잠깐 혼자만의 시간 갖기", "화난 이유 차근차근 말해보기", "운동이나 산책하기", "화를 다스리는 방법 함께 찾기", "감정 표현하는 법 연습하기"]
            },
            {
                id: 18,
                title: "자꾸 울게 되어서 부끄러워요 😭",
                description: "조금만 속상해도 눈물이 나와서 친구들 앞에서 자주 울게 돼요. 친구들이 저를 약하다고 생각할까봐 걱정돼요.",
                helpMethods: ["울어도 괜찮다고 위로하기", "감정 표현하는 다른 방법 알려주기", "속상한 이유 들어주기", "강한 점들 찾아서 말해주기", "함께 감정 조절 연습하기", "울고 나면 기분이 나아진다고 말해주기"]
            },
            // 신체적 문제
            {
                id: 19,
                title: "다른 친구들보다 키가 작아서 속상해요 😟",
                description: "반에서 키가 제일 작아서 줄을 설 때도 항상 맨 앞이에요. 친구들이 놀리지는 않지만 키 큰 친구들이 부러워요.",
                helpMethods: ["키가 작아도 좋은 점 찾아주기", "키는 나중에 더 클 수 있다고 말해주기", "다른 장점들 찾아서 칭찬하기", "키와 상관없이 함께 놀기", "자신감을 가지라고 격려하기", "키 말고 다른 이야기 하기"]
            },
            {
                id: 20,
                title: "운동을 못해서 체육시간이 싫어요 😣",
                description: "달리기도 느리고 공도 잘 못 받아서 체육시간만 되면 스트레스예요. 팀을 나눌 때도 항상 마지막에 선택받아서 속상해요.",
                helpMethods: ["연습하면 잘할 수 있다고 격려하기", "함께 연습해주기", "운동 말고 다른 잘하는 것 찾아주기", "팀에서 따뜻하게 받아주기", "체육 선생님께 도움 요청하기", "노력하는 모습 칭찬해주기"]
            }
        ];

        let currentSituations = [];
        let currentStep = 0;
        let selectedSituation = null;

        // 초기화
        function init() {
            shuffleSituations();
            setupEventListeners();
        }

        // 상황 셔플 및 6개 선택
        function shuffleSituations() {
            const shuffled = [...allSituations].sort(() => Math.random() - 0.5);
            currentSituations = shuffled.slice(0, 6);
            renderSituationCards();
        }

        // 상황 카드 렌더링
        function renderSituationCards() {
            const container = document.getElementById('situationCards');
            container.innerHTML = currentSituations.map(situation => `
                <div class="situation-card" data-id="${situation.id}">
                    <h3>${situation.title}</h3>
                    <p>${situation.description.substring(0, 85)}...</p>
                </div>
            `).join('');
        }

        // 도움 방법 렌더링
        function renderHelpMethods(methods) {
            const container = document.getElementById('helpMethods');
            container.innerHTML = methods.map((method, index) => `
                <div class="checkbox-item flex items-center space-x-3 p-4 bg-gradient-to-r from-purple-50 to-pink-50 rounded-xl border border-purple-100 hover:border-purple-200 transition-all duration-200">
                    <input type="checkbox" id="help_${index}" class="custom-checkbox">
                    <label for="help_${index}" class="text-gray-700 cursor-pointer flex-1 font-medium">${method}</label>
                </div>
            `).join('');
        }

        // 이벤트 리스너 설정
        function setupEventListeners() {
            // 상황 선택
            document.getElementById('situationCards').addEventListener('click', (e) => {
                const card = e.target.closest('.situation-card');
                if (card) {
                    selectSituation(parseInt(card.dataset.id));
                }
            });

            // 셔플 버튼
            document.getElementById('shuffleBtn').addEventListener('click', () => {
                shuffleSituations();
                resetWorksheet();
            });

            // 다음 단계 버튼
            document.getElementById('nextStepBtn').addEventListener('click', nextStep);

            // 출력 버튼
            document.getElementById('printBtn').addEventListener('click', () => {
                document.querySelector('.print-only').style.display = 'block';
                window.print();
                document.querySelector('.print-only').style.display = 'none';
            });

            // 이미지 다운로드 버튼
            document.getElementById('downloadBtn').addEventListener('click', downloadAsImage);

            // 다시 시작 버튼
            document.getElementById('resetBtn').addEventListener('click', reset);
        }

        // 워크시트 초기화
        function resetWorksheet() {
            selectedSituation = null;
            currentStep = 0;
            
            // 모든 단계 숨기기
            document.getElementById('situationDetailCard').style.display = 'none';
            document.getElementById('selectedSituation').style.display = 'none';
            document.getElementById('step1').style.display = 'none';
            document.getElementById('step2').style.display = 'none';
            document.getElementById('step3').style.display = 'none';
            document.getElementById('reflection').style.display = 'none';
            
            // 버튼 상태 초기화
            document.getElementById('nextStepBtn').style.display = 'none';
            document.getElementById('printBtn').style.display = 'none';
            document.getElementById('downloadBtn').style.display = 'none';
            document.getElementById('resetBtn').style.display = 'none';
            
            // 입력 필드 초기화
            document.querySelectorAll('input, textarea').forEach(field => {
                field.value = '';
            });
            document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                checkbox.checked = false;
            });
            
            // 선택된 카드 초기화
            document.querySelectorAll('.situation-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            // 맨 위로 스크롤
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // 상황 선택
        function selectSituation(id) {
            selectedSituation = allSituations.find(s => s.id === id);
            
            // 선택된 카드 표시
            document.querySelectorAll('.situation-card').forEach(card => {
                card.classList.remove('selected');
            });
            document.querySelector(`[data-id="${id}"]`).classList.add('selected');

            // 상황 상세 설명 표시
            document.getElementById('situationDetailDescription').textContent = selectedSituation.description;
            document.getElementById('situationDetailCard').style.display = 'block';
            
            // 워크시트 영역의 상황 표시
            document.getElementById('situationDescription').textContent = selectedSituation.description;
            document.getElementById('selectedSituation').style.display = 'block';
            
            // 도움 방법 렌더링
            renderHelpMethods(selectedSituation.helpMethods);
            
            // 1단계 표시
            document.getElementById('step1').style.display = 'block';
            document.getElementById('nextStepBtn').style.display = 'block';
            
            // 다시 시작 버튼 표시
            document.getElementById('resetBtn').style.display = 'inline-block';
            
            // 선택된 상황으로 부드럽게 스크롤
            setTimeout(() => {
                document.getElementById('situationDetailCard').scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'start' 
                });
            }, 300);
            
            currentStep = 1;
        }

        // 다음 단계
        function nextStep() {
            if (currentStep === 1) {
                const emotion = document.getElementById('friendEmotion').value.trim();
                const empathy = document.getElementById('empathyWords').value.trim();
                
                if (!emotion || !empathy) {
                    alert('친구의 기분과 공감하는 말을 모두 써주세요! 😊');
                    return;
                }
                
                document.getElementById('step2').style.display = 'block';
                currentStep = 2;
            } 
            else if (currentStep === 2) {
                const checkedMethods = document.querySelectorAll('#helpMethods input:checked').length;
                
                if (checkedMethods === 0) {
                    alert('친구를 도울 방법을 하나 이상 선택해주세요! 🤝');
                    return;
                }
                
                document.getElementById('step3').style.display = 'block';
                currentStep = 3;
            }
            else if (currentStep === 3) {
                const positiveWords = document.getElementById('positiveWords').value.trim();
                
                if (!positiveWords) {
                    alert('친구에게 힘이 되는 긍정적인 말을 써주세요! ✨');
                    return;
                }
                
                document.getElementById('reflection').style.display = 'block';
                document.getElementById('nextStepBtn').style.display = 'none';
                document.getElementById('printBtn').style.display = 'inline-block';
                document.getElementById('downloadBtn').style.display = 'inline-block';
                currentStep = 4;
            }
        }

        // 이미지로 다운로드
        async function downloadAsImage() {
            try {
                const worksheetArea = document.getElementById('worksheetArea');
                
                document.querySelector('.print-only').style.display = 'block';
                
                const canvas = await html2canvas(worksheetArea, {
                    scale: 2,
                    backgroundColor: '#ffffff',
                    useCORS: true,
                    allowTaint: false
                });
                
                document.querySelector('.print-only').style.display = 'none';
                
                const link = document.createElement('a');
                link.download = `친구마음도우미_${new Date().toLocaleDateString('ko-KR')}.png`;
                link.href = canvas.toDataURL();
                link.click();
                
                alert('이미지가 저장되었습니다! 📸');
            } catch (error) {
                console.error('이미지 저장 실패:', error);
                alert('이미지 저장에 실패했습니다. 다시 시도해주세요.');
            }
        }

        // 다시 시작
        function reset() {
            if (confirm('정말로 다시 시작하시겠습니까? 작성한 내용이 모두 사라집니다.')) {
                location.reload();
            }
        }

        // 페이지 로드 시 초기화
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
